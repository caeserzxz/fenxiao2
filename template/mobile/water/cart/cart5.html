<include file="common/header" title="订单提交" body="g4" xmlns="http://www.w3.org/1999/html"/>
<style>
    .cardbox {
        position: relative;
        margin-top: 15px;
        margin-left: 10px;
        margin-right: 10px;
        margin-bottom: 15px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        overflow: visible;
    }

    .cardbox:before {
        content: "";
        position: absolute;
        width: 1.35rem;
        height: 1.15rem;
        background: url(__STATIC__/images/kouzi.png) no-repeat;
        background-size: 100%;
        right: 1rem;
        top: -0.37rem;
    }

    .cardbox:after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: -10px;
        height: 10px;
        background: url(__STATIC__/images/cardbottom.png) no-repeat;
        background-size: 100%;
    }

    .card-top:after, .card-top:before {
        position: absolute;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background-color: #f8f8f8;
        content: "";
        z-index: 9;
        bottom: -8px;
    }

    .card-top:after {
        right: -8px;
    }

    .card-top:before {
        left: -8px;
    }
    .weui-cells_checkbox .weui-check:checked + .weui-icon-checked:before {
        border-radius: 100%;
    }
    .weui-cells_checkbox .weui-icon-checked:before {
        border: 0px;
    }
</style>

<include file="common/header_nav" title="订单提交" href="{:U('Mobile/Order/order_list')}"/>

<div class="page-bd">
    <div class="weui-cells weui-cells_checkbox cardbox">
        <div class="weui-cell" style="padding: 1rem 0; border-bottom: 1px dashed #e0e0e0;">
            <div class="weui-cell__bd tc card-top">
                <div>付款金额</div>
                <div class="text-red mt5"><span class="fs12">￥</span><b class="fs20">{$order[order_amount]}</b></div>
            </div>
        </div>
        <!-- <label class="weui-cell tbornone after-left__0 weui-check__label" for="s11">
             <div class="weui-cell__hd">
                 <input type="checkbox" class="weui-check" name="checkbox1" id="s11" checked="checked">
                 <i class="weui-icon-checked"></i>
             </div>
             <div class="weui-cell__bd">
                 <div class="fs11">可用余额支付</div>
                 <div class="fs9 text-muted">当前可用余额￥365</div>
             </div>
             <div><span>￥</span><b>365.00</b></div>
         </label>
         <label class="weui-cell after-left__0 weui-check__label" for="s12">
             <div class="weui-cell__hd">
                 <input type="checkbox" class="weui-check" name="checkbox1" id="s12" checked="checked">
                 <i class="weui-icon-checked"></i>
             </div>
             <div class="weui-cell__bd">
                 <div class="fs11">可用佣金支付</div>
                 <div class="fs9 text-muted">当前可用佣金￥125</div>
             </div>
             <div><span>￥</span><b>56.00</b></div>
         </label>
         <label class="weui-cell after-left__0 weui-check__label" for="s13">
             <div class="weui-cell__hd">
                 <input type="checkbox" class="weui-check" name="checkbox1" id="s13" checked="checked">
                 <i class="weui-icon-checked"></i>
             </div>
             <div class="weui-cell__bd">
                 <div class="fs11">可用积分抵扣</div>
                 <div class="fs9 text-muted">可用积分抵扣</div>
             </div>
             <div><span>￥</span><b>32.56</b></div>
         </label>
     </div>-->
        <form action="{:U('mobile/payment/getCode')}" method="post" name="cart4_form" id="cart4_form">

            <div class="weui-panel weui-panel_access">
                <!-- <div class="weui-panel__hd">
                     <div class="text-red fr" style="line-height: 1.4em;"><span class="fs12">￥</span><b
                             class="fs15">832.56</b></div>
                     <div class="fs11">还需支付</div>
                 </div>-->

                <div class="weui-panel__bd fs10">
                    <div class="weui-cells mt0 weui-cells_radio">
                        <foreach name="paymentList" key="k" item="v">
                            <label class="weui-cell weui-cell_access weui-check__label" for="x{$k}">
                                <div class="weui-cell__hd">
                                    <input type="radio" class="weui-check" value="pay_code={$v['code']}"
                                           name="pay_radio" id="x{$k}">
                                    <span class="weui-icon-checked"></span></div>
                                <div class="weui-cell__bd">
                                    <div class="fs11"> {$v[name]}</div>
                                </div>
                                <div class="weui-cell__ft">
                                    <img style="height: 24px;" src="/plugins/{$v['type']}/{$v['code']}/{$v['icon']}"
                                         alt="">
                                </div>
                            </label>
                            <!--  <li  onClick="changepay(this);">
                                  <label>
                                      <div class="radio fl">
                                  <span class="che {$k}">
                                      <i>
                                          <input type="radio"   value="pay_code={$v['code']}" class="c_checkbox_t" name="pay_radio" style="display:none;"/>
                                      </i>
                                  </span>
                                      </div>
                                      <div class="pay-list-img fl">
                                          <img src="/plugins/{$v['type']}/{$v['code']}/{$v['icon']}"/>
                                      </div>
                                      <div class="pay-list-font fl">
                                          {$v[name]}
                                      </div>
                                  </label>
                              </li>-->
                        </foreach>
                        <!--  <label class="weui-cell weui-cell_access weui-check__label" for="x11">
                              <div class="weui-cell__hd"><input type="radio" checked class="weui-check" name="radio1"
                                                                id="x11">
                                  <span class="weui-icon-checked"></span></div>
                              <div class="weui-cell__bd">
                                  <div class="fs11">在线支付</div>
                              </div>
                              <div class="weui-cell__ft">
                                  <img style="width: 0.8rem;" src="__STATIC__/images/pay_icon01.png" alt=""> <span>微信支付</span>
                              </div>
                          </label>
                          <label class="weui-cell weui-check__label" for="x12">
                              <div class="weui-cell__hd"><input type="radio" class="weui-check" name="radio1" id="x12">
                                  <span class="weui-icon-checked"></span></div>
                              <div class="weui-cell__bd">
                                  <div class="fs11">货到付款</div>
                              </div>
                          </label>-->
                        <input type="hidden" name="order_id" value="{$order['id']}"/>
                        <input type="hidden" name="goods_type" value="1"/>
                    </div>
                </div>
            </div>
        </form>
        <div class="weui-btn-area">
                <a href="javascript:void(0);" onclick="vipOrderPay()" class="weui-btn weui-btn_primary">去付款</a>
                <!--<a href="javascript:void(0);" id="test11" class="weui-btn weui-btn_primary">测试</a>-->
        </div>
    </div>

</div>

<script src="__STATIC__/js/ios.js"  type="text/javascript" ></script>

<script>
    //app页面调试工具
//    javascript:(function () { var script = document.createElement('script'); script.src="//cdn.jsdelivr.net/npm/eruda"; document.body.appendChild(script); script.onload = function () { eruda.init() } })();
</script>

<script>

    function vipOrderPay() {
        var radio = $('input:radio:checked').val();
        var u = navigator.userAgent;
        var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1;//判断是否为安卓终端

        if(radio == "pay_code=alipayMobile"){
            var callback_url = "{:U('Mobile/User/index')}";

            $.ajax({
                type: "POST",
                url: "{:U('Mobile/Payment/getCodeVip')}",//+tab,
                data: $('#cart4_form').serialize(),// 你的formid
                dataType: "json",
                success: function (data) {
                    if(data.status=1){
                        if (isAndroid) {    //app,安卓调起支付宝支付
                            window.auc.AliPay(data.data);
                        }else {     //app，ios调起支付宝支付

                            window.app.AliPay(data.data,callback_url);
                        }
                    }
                }
            });
        }else {
            $.ajax({
                type: "POST",
                url: "{:U('Mobile/Payment/getCodeVip')}",//+tab,
                data: $('#cart4_form').serialize(),// 你的formid
                dataType: "json",
                success: function (data) {

                    if (isAndroid) {     //app,安卓调起微信支付
                        wxApp(data.js,data.url);

                    }else {         //app,ios调起微信支付
                        window.app.wxPay(data.js,data.url);
                    }

                }
            });
        }

    }

    function aliPayCallback(){
        window.location.href = "{:U('Mobile/User/index')}";
    }

    function wxApp(js,url){

        window.auc.wxPay(js,url);
    };

    function wxPayCallback(){
        window.location.href = "{:U('Mobile/User/index')}";
    }

</script>

